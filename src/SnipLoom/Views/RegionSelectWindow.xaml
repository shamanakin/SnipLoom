<Window x:Class="SnipLoom.Views.RegionSelectWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Select Region"
        WindowStyle="None"
        AllowsTransparency="True"
        Background="Transparent"
        Topmost="True"
        ShowInTaskbar="False"
        ResizeMode="NoResize"
        Cursor="Cross">
    
    <Window.Resources>
        <Style x:Key="AspectButton" TargetType="Button">
            <Setter Property="Background" Value="#444"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="Padding" Value="8,4"/>
            <Setter Property="Margin" Value="2,0"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Cursor" Value="Hand"/>
        </Style>
        <Style x:Key="AspectButtonSelected" TargetType="Button">
            <Setter Property="Background" Value="#0078d4"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="Padding" Value="8,4"/>
            <Setter Property="Margin" Value="2,0"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Cursor" Value="Hand"/>
        </Style>
    </Window.Resources>
    
    <Grid>
        <!-- Dimmed overlay with cutout for selection -->
        <Path x:Name="DimOverlay" Fill="#80000000" IsHitTestVisible="False"/>
        
        <!-- Canvas for all positioned elements -->
        <Canvas x:Name="MainCanvas">
            <!-- Selection rectangle border -->
            <Border x:Name="SelectionBorder" 
                    BorderBrush="#0078d4" 
                    BorderThickness="3"
                    Background="Transparent"
                    Visibility="Collapsed"
                    IsHitTestVisible="False"/>
            
            <!-- Size indicator -->
            <Border x:Name="SizeIndicator"
                    Background="#cc202020"
                    CornerRadius="4"
                    Padding="8,4"
                    Visibility="Collapsed"
                    IsHitTestVisible="False">
                <TextBlock x:Name="SizeText" Foreground="White" FontFamily="Consolas" FontSize="12"/>
            </Border>
            
            <!-- Resize handles (8 corners/edges) -->
            <Rectangle x:Name="HandleNW" Width="10" Height="10" Fill="#0078d4" Cursor="SizeNWSE" Visibility="Collapsed"/>
            <Rectangle x:Name="HandleN" Width="10" Height="10" Fill="#0078d4" Cursor="SizeNS" Visibility="Collapsed"/>
            <Rectangle x:Name="HandleNE" Width="10" Height="10" Fill="#0078d4" Cursor="SizeNESW" Visibility="Collapsed"/>
            <Rectangle x:Name="HandleW" Width="10" Height="10" Fill="#0078d4" Cursor="SizeWE" Visibility="Collapsed"/>
            <Rectangle x:Name="HandleE" Width="10" Height="10" Fill="#0078d4" Cursor="SizeWE" Visibility="Collapsed"/>
            <Rectangle x:Name="HandleSW" Width="10" Height="10" Fill="#0078d4" Cursor="SizeNESW" Visibility="Collapsed"/>
            <Rectangle x:Name="HandleS" Width="10" Height="10" Fill="#0078d4" Cursor="SizeNS" Visibility="Collapsed"/>
            <Rectangle x:Name="HandleSE" Width="10" Height="10" Fill="#0078d4" Cursor="SizeNWSE" Visibility="Collapsed"/>
        </Canvas>
        
        <!-- Aspect ratio toolbar (shown at top, user picks ratio BEFORE drawing) -->
        <Border x:Name="AspectToolbar" 
                Background="#e0202020" 
                CornerRadius="6" 
                Padding="8,4"
                HorizontalAlignment="Center"
                VerticalAlignment="Top"
                Margin="0,20,0,0">
            <StackPanel Orientation="Horizontal">
                <TextBlock Text="Aspect:" Foreground="White" VerticalAlignment="Center" Margin="0,0,8,0"/>
                <Button x:Name="Btn16_9" Content="16:9" Click="AspectRatio_Click" Tag="1.777778" Style="{StaticResource AspectButtonSelected}"/>
                <Button x:Name="Btn9_16" Content="9:16" Click="AspectRatio_Click" Tag="0.5625" Style="{StaticResource AspectButton}"/>
                <Button x:Name="Btn1_1" Content="1:1" Click="AspectRatio_Click" Tag="1" Style="{StaticResource AspectButton}"/>
                <Button x:Name="Btn5_4" Content="5:4" Click="AspectRatio_Click" Tag="1.25" Style="{StaticResource AspectButton}"/>
                <Button x:Name="Btn4_5" Content="4:5" Click="AspectRatio_Click" Tag="0.8" Style="{StaticResource AspectButton}"/>
                <Rectangle Width="1" Fill="#444" Margin="8,2"/>
                <Button x:Name="BtnConfirm" Content="âœ“ Start Recording" Click="Confirm_Click" Background="#28a745" Foreground="White" Padding="12,4" Margin="4,0" BorderThickness="0" FontWeight="Bold" Visibility="Collapsed"/>
                <Button x:Name="BtnCancel" Content="Cancel" Click="Cancel_Click" Background="#444" Foreground="White" Padding="12,4" BorderThickness="0"/>
            </StackPanel>
        </Border>
        
        <!-- Instructions overlay -->
        <Border x:Name="InstructionsOverlay"
                Background="#cc000000"
                HorizontalAlignment="Center"
                VerticalAlignment="Center"
                CornerRadius="8"
                Padding="24,16">
            <StackPanel>
                <TextBlock Text="Draw a region to capture" 
                           Foreground="White" 
                           FontSize="20" 
                           FontWeight="SemiBold"
                           HorizontalAlignment="Center"/>
                <TextBlock Text="1. Select aspect ratio above (default: 16:9)" 
                           Foreground="#aaa" 
                           FontSize="14"
                           HorizontalAlignment="Center"
                           Margin="0,8,0,0"/>
                <TextBlock Text="2. Click and drag to draw your region" 
                           Foreground="#aaa" 
                           FontSize="14"
                           HorizontalAlignment="Center"
                           Margin="0,4,0,0"/>
                <TextBlock Text="3. Click the green 'Start Recording' button" 
                           Foreground="#aaa" 
                           FontSize="14"
                           HorizontalAlignment="Center"
                           Margin="0,4,0,0"/>
            </StackPanel>
        </Border>
    </Grid>
</Window>
